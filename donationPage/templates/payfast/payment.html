{% extends "base.html" %}

{% load static %}
{{ form.media }}
{% load fb_versions %}
{% block title %}
    Payfast payments{{block.super}}
{% endblock %}
{% block content %}

{% block css-override %}
    {{block.super}}
    <style>
        .custom-card {
                border: 1px solid #ddd;
                border-radius: 4px;
                margin-bottom: 20px;
            }
        .custom-card .custom-card-header {
            background-color: #f5f5f5;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
        }
        .custom-card .custom-card-body {
            padding: 15px;
        }
        .custom-card .custom-card-footer {
            background-color: #f5f5f5;
            padding: 10px;
            border-top: 1px solid #ddd;
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
            text-align: right;
        }
        div.thumbnail {
            padding: 10px;
            border: 1px solid #ccc;
            min-height: 280px;
        }

        .summary-caption {
            text-align: center;
            margin-top: 5px;
        }
        .donor-dash-link {
            padding-top: 20px;
        }
        
        .donation-form-panel {
            background: #ffffff;
            border: 1px solid #e1e8ed;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-radius: 8px;
        }
        .donation-form-panel .panel-heading {
            background: #00b2f0;
            color: white;
            border-bottom: none;
            padding: 24px;
            font-size: 20px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }
        .donation-form-panel .panel-body {
            padding: 32px 28px;
        }
        .donation-intro {
            text-align: center;
            margin-bottom: 32px;
            padding: 20px;
            background: #f8fafb;
            border-radius: 6px;
            border-left: 4px solid #00b2f0;
        }
        .donation-intro p {
            color: #495057;
            line-height: 1.6;
            margin: 0;
        }
        .donation-form-row {
            margin-bottom: 20px;
        }
        .donation-form-row .form-control {
            border: 1.5px solid #d1d9e0;
            border-radius: 6px;
            padding: 12px 14px;
            transition: all 0.2s ease;
            background: #ffffff;
        }
        .donation-form-row .form-control:focus {
            border-color: #00b2f0;
            box-shadow: 0 0 0 3px rgba(0, 178, 240, 0.1);
            outline: none;
        }
        .donation-form-row label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: block;
        }
        .radio-group {
            display: flex;
            gap: 16px;
            margin-top: 10px;
            padding: 12px;
            background: #f8fafb;
            border-radius: 6px;
        }
        .radio-group label {
            font-weight: 500;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin: 0;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background 0.2s ease;
            color: #495057;
        }
        .radio-group label:hover {
            background: #e9ecef;
        }
        .radio-group input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        .donation-submit-btn {
            background: #000000;
            color: white;
            border: none;
            padding: 14px 28px;
            font-weight: 600;
            border-radius: 6px;
            width: 100%;
            transition: all 0.2s ease;
            margin-top: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .donation-submit-btn:hover {
            background: #1a1a1a;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        .donation-submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .amount-input-wrapper {
            position: relative;
        }
        .amount-input-wrapper::before {
            content: "R";
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #495057;
            font-weight: 700;
            pointer-events: none;
        }
        .amount-input-wrapper .form-control {
            padding-left: 38px;
            font-weight: 600;
        }
        
        @media (max-width: 767px) {
            .donation-form-panel .panel-body {
                padding: 24px 20px;
            }
            .radio-group {
                flex-direction: column;
                gap: 8px;
            }
            .radio-group label {
                width: 100%;
            }
        }
    </style>
{% endblock %}



<div class="jumbotron full-width-jumbotron">
    <div style="margin: auto;
        width: 70%;
        max-width: 750px;
        padding: 10px;" class="text-center"
    >
        <h1>Donate to GroundUp</h1>
        <h3>With your help, we can hold those in power accountable and train the next generation of journalists.</h3>
    </div>
</div>

<div style="margin: auto; width: 70%; max-width: 750px; padding: 10px;">

    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="donation-form-panel">
                <div class="panel-heading">Support Independent Journalism</div>
                <div class="panel-body">
                    <div class="donation-intro">
                        <p>Help us hold those in power accountable by making a contribution to support our independent journalism.</p>
                    </div>
                    
                    <form method="POST" id="subscriptionForm">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="donation-form-row">
                                    <label for="first_name">First Name</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" required>
                                    {% for error in form.first_name.errors %}
                                        <span class="help-block">{{ error }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="donation-form-row">
                                    <label for="last_name">Last Name</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" required>
                                    {% for error in form.last_name.errors %}
                                        <span class="help-block">{{ error }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="donation-form-row">
                            <label for="email">Email Address</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                            {% for error in form.email.errors %}
                                <span class="help-block">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <div class="donation-form-row">
                            <label>Choose Your Contribution Type</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="payment_type" value="subscription" checked> 
                                    <span>Monthly Subscription</span>
                                </label>
                                <label>
                                    <input type="radio" name="payment_type" value="one_time"> 
                                    <span>One-Time Donation</span>
                                </label>
                            </div>
                        </div>

                        <div class="donation-form-row">
                            <label for="amount">Donation Amount (ZAR)</label>
                            <div class="amount-input-wrapper">
                                <input type="number" class="form-control" id="amount" name="amount" value="100" min="10" required>
                            </div>
                            {% for error in form.amount.errors %}
                                <span class="help-block">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <button type="submit" class="donation-submit-btn" id="submitButton">
                            Make Donation
                        </button>
                    </form>
                    
                    <p class="donor-dash-link text-center">Already a Donor? Access your <a href="{% url 'donor_access' %}">donor dashboard</a></p>
                </div>
            </div>
        </div>
    </div>

    <hr>
    <div class="row">
        <div class="col-md-12">
            <h2>Why donate to GroundUp?</h2>

            <p>We are a non-profit news agency, which means we rely on your donations to do our work. We don’t run ads and our articles are always free to read. Plus, your donation is tax-deductible. With your support, we can continue to provide fair and accurate news from the ground up.</p>

            <p><a href="https://groundup.org.za/support/">Read more</a> about what GroundUp does and why it's worth supporting us.</p>

            <hr>
            <h2>Who funds us?</h2>

            <p>Much of our funding is from&nbsp;institutional donors - but we need more of our readers to&nbsp;support us. For context, an everyday article costs R5,000 or so to publish. That’s excluding rent, insurance, computers, cameras and all the other things you need to run a newsroom. Also, we sometimes get sued or taken to the press ombudsman. Even though we almost always win, we spend quite a bit on legal fees.</p>

            <p>(By the way, we're independent, so while we appreciate all donations, donors don't have a say in what we publish.)</p>

            <hr>
            <h2 id="alternate-payment">Want to donate using a different payment method?</h2>
            &nbsp;

            <div class="row flex-row">
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <div class="thumbnail">
                        <h3>EFT</h3>
                        <p><strong>Bank:</strong> Nedbank<br>
                        <strong>Account number:</strong> 1206484632<br>
                        <strong>Branch code:</strong> 198765<br>
                        <strong>Swift:</strong> NEDSZAJJ</p>

                        <p>Please use your email address as the reference.</p>
                    </div>
                </div>

                <div class="col-xs-12 col-sm-4 col-md-4">
                    <div class="thumbnail">
                        <h3>Paypal</h3>
                        <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                            <p><input name="cmd" type="hidden" value="_s-xclick"> <input name="hosted_button_id" type="hidden" value="4UETCB7SL6CNA"> <input alt="PayPal" border="0" name="submit" src="https://www.groundup.org.za/media/uploads/images/Graphics/paypal-donate-300x136.png" style="width:120px;" type="image"> <img alt="" border="0" height="1" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1"></p>
                        </form>
                        <p>If you have unused PayPal credits sitting in your account, consider donating them to GroundUp to support independent journalism.</p>
                    </div>
                </div>

                <div class="col-xs-12 col-sm-4 col-md-4">
                    <div class="thumbnail">
                        <h3>US donors</h3>
                        <p>You can make a tax-deductible donation from the United States via the South African Development Fund. Click <a href="http://www.sadevelopmentfund.org/donate">here</a> for various ways to donate. Please indicate that your donation is for "GroundUp".</p>
                    </div>
                </div>


            </div>
            <div class="row flex-row">
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <div class="thumbnail">
                        <h3>GroundUp details</h3>
                        <p><strong>Non-profit registration:</strong> 254-625-NPO<br>
                        <strong>Public benefit organisation:</strong> 930071956<br>
                        <strong>VAT registration:</strong> 4270293717</p>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <div class="thumbnail">
                        <h3><a href="https://pos.snapscan.io/qr/STB24E42"><img alt="Snapscan" src="/static/donationPage/snapscan-logo.png" style="width:120px; margin: inherit !important;"  /></a></h3>
                        <p style="text-align: center;">
                        <span class="mobile-only"><a href="https://pos.snapscan.io/qr/STB24E42">Donate using SnapScan</a>. </span><br />
                        <a href="https://pos.snapscan.io/qr/STB24E42"><img alt="Snapscan QR code" class="barcode" src="/static/donationPage/groundup-snapscan.png" style="width:150px !important;" /></a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript-includes %}
    {{block.super}}
    <script>
        $(document).ready(function() {
            $('#subscriptionForm').on('submit', function(e) {
                e.preventDefault();

                var submitButton = $('#submitButton');
                var originalText = submitButton.text();
                submitButton.prop('disabled', true).text('Processing...');

                var formData = $(this).serialize();

                $.ajax({
                    type: 'POST',
                    url: $(this).attr("action"),
                    data: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    success: function(response) {
                        if (response.errors){
                            alert('Please correct the form errors and try again.');
                            submitButton.prop('disabled', false).text(originalText);
                        } else if(response.html){
                            $("body").append(response.html);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('Something went wrong. Please try again.');
                        submitButton.prop('disabled', false).text(originalText);
                    }
                });
            });
        });
    </script>
{% endblock %}
